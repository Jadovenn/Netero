version: '3'

services:
  ci:
    container_name: netero-ci
    image: jadomage/ci-gcc-nasm-cmake-lcov:0.0.3
    volumes:
      - .:/opt/netero
    command: bash -c "
      rm -rf /opt/netero/build
      && mkdir /opt/netero/build
      && cd /opt/netero/build
      && cmake .. -DCODE_COVERAGE=ON -DAUDIO=OFF -DENGINE=OFF
      && make
      && make test
      && lcov --capture --directory . --output-file coverage.info
      && lcov --remove coverage.info '/usr/*' --output-file coverage.info
      && lcov --list coverage.info"