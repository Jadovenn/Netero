version: '3'

services:
  ci:
    container_name: netero-ci
    image: rpgillespie6/fastcov:latest
    volumes:
      - .:/opt/netero
    command: bash -c "
      mkdir /opt/netero/build
      && cd /opt/netero/build
      && cmake .. -DCODE_COVERAGE=ON -DAUDIO=OFF -DENGINE=OFF
      && make
      && make test
      && lcov --capture --directory . --output-file coverage.info
      && lcov --remove coverage.info '/usr/*' --output-file coverage.info
      && lcov --list coverage.info"